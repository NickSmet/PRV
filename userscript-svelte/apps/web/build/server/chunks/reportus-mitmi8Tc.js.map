{"version":3,"file":"reportus-mitmi8Tc.js","sources":["../../../.svelte-kit/adapter-node/chunks/reportus.js"],"sourcesContent":["import { b as private_env } from \"./shared-server.js\";\nfunction createReportusClient(opts) {\n  const baseUrl = opts.baseUrl.replace(/\\/+$/, \"\");\n  const authHeader = opts.basicAuth.startsWith(\"Basic \") ? opts.basicAuth : `Basic ${opts.basicAuth}`;\n  function encodeFilePathSegments(filePath) {\n    return filePath.split(\"/\").map(encodeURIComponent).join(\"/\");\n  }\n  async function getReportIndex(reportId) {\n    const res = await fetch(`${baseUrl}/api/reports/${encodeURIComponent(reportId)}`, {\n      headers: { Authorization: authHeader }\n    });\n    if (!res.ok) {\n      throw new Error(`Reportus getReportIndex failed: HTTP ${res.status}`);\n    }\n    return await res.json();\n  }\n  async function downloadFileBytes(reportId, filePath, opts2) {\n    const maxBytes = opts2?.maxBytes ?? 2 * 1024 * 1024;\n    const url = `${baseUrl}/api/reports/${encodeURIComponent(reportId)}/files/${encodeFilePathSegments(filePath)}/download`;\n    const res = await fetch(url, { headers: { Authorization: authHeader } });\n    if (!res.ok) {\n      throw new Error(`Reportus downloadFileBytes failed: HTTP ${res.status}`);\n    }\n    const reader = res.body?.getReader();\n    if (!reader) {\n      const ab = await res.arrayBuffer();\n      const bytes = new Uint8Array(ab);\n      return { bytes: bytes.slice(0, maxBytes), truncated: bytes.length > maxBytes };\n    }\n    const chunks = [];\n    let total = 0;\n    let truncated = false;\n    while (true) {\n      const { value, done } = await reader.read();\n      if (done) break;\n      if (!value) continue;\n      if (total + value.length > maxBytes) {\n        const remaining = Math.max(0, maxBytes - total);\n        if (remaining > 0) chunks.push(value.slice(0, remaining));\n        truncated = true;\n        break;\n      }\n      chunks.push(value);\n      total += value.length;\n    }\n    if (truncated) {\n      try {\n        await reader.cancel();\n      } catch {\n      }\n    }\n    const out = new Uint8Array(chunks.reduce((sum, c) => sum + c.length, 0));\n    let offset = 0;\n    for (const c of chunks) {\n      out.set(c, offset);\n      offset += c.length;\n    }\n    return { bytes: out, truncated };\n  }\n  async function downloadFileText(reportId, filePath, opts2) {\n    const { bytes, truncated } = await downloadFileBytes(reportId, filePath, opts2);\n    const text = new TextDecoder(\"utf-8\", { fatal: false }).decode(bytes);\n    return { text, truncated };\n  }\n  return { getReportIndex, downloadFileText, downloadFileBytes };\n}\nfunction getReportusClient() {\n  const baseUrl = private_env.REPORTUS_BASE_URL ?? \"https://reportus.prls.net\";\n  const basicAuth = private_env.REPORTUS_BASIC_AUTH;\n  if (!basicAuth) {\n    throw new Error(\"Missing REPORTUS_BASIC_AUTH\");\n  }\n  return createReportusClient({ baseUrl, basicAuth });\n}\nexport {\n  getReportusClient as g\n};\n"],"names":[],"mappings":"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"}